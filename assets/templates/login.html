<!DOCTYPE html>
<html lang="en">
<title>FocusXgen TradeStation Client</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  body {
    font-family: "Lato", sans-serif;
    color: white;
    background-color: #0b121a;
  }
  .border {
    border-color: grey!important;
  }
  hr.dashed {
    border-top: 2px dashed #999;
  }

  hr.dotted {
    border-top: 2px dotted #999;
  }

  hr.solid {
    border-top: 2px solid #ffd000;
  }
</style>
<body>
  <!--Login-->
  <div class="container-fluid">
    <div class="row py-5 my-5 justify-content-center">
      <form method="post" class="border rounded col-12 col-md-6 col-sm-10 align-self-center">
        <h3 class="row pt-5 m-0 justify-content-center text-center">FocusXgen TradeStation Client</h1>
        <hr class="solid mb-5" style="margin-left: 35%; margin-right: 35%">
        <div class="row justify-content-center text-center table-responsive">
          <h5 class="py-3">Active Accounts</h3>
          <table class="small table table-sm table-dark">
            <thead>
              <tr>
                <th scope="col">Account</th>
                <th scope="col">Username</th>
                <th scope="col">Logged In</th>
                <th scope="col"></th>
              </tr>
              
            </thead>
            <tbody id="ActiveAccounts" class="align-middle">
             
            </tbody>
          </table>
        </div>
        <div class="my-3 pb-3 text-center">
          <a class="btn btn-success btn-dark-outline" onclick="Start()">Start</a>
        </div>
      </form>

    </div>
    

    <footer>
      <!-- Copyright -->
      <div class="footer-copyright text-center py-3 text-muted">Â© 2020 Copyright:
        <a href="">FocusXgen | Powered by David Gabriel</a>
      </div>
      <!-- Copyright -->
    </footer>

    <script>
      (async function Accounts(orderId) {
      await fetch(`/api/accounts`).then((res) => res.json()).then(async (allacccounts) => {
        console.log(allacccounts)

        table = document.getElementById("ActiveAccounts")
        for (i = 0; i < allacccounts.length; i++) {
          let account = allacccounts[i];
          let loggedIn;
          if (account['log_in'] && account['auth_state']) {
            loggedIn = "Connected";
          } else {loggedIn = "Disconnected"};

          let row = table.insertRow(i);
          let cell0 = row.insertCell(0);
          let cell1 = row.insertCell(1);
          let cell2 = row.insertCell(2);
          let cell3 = row.insertCell(3);
          cell0.innerHTML = account['client_id'];
          cell1.innerHTML = account['username'];
          cell2.innerHTML = loggedIn;
          cell3.innerHTML = "<a class='btn btn-primary' href='/login?client_id=" + account['client_id'] + "'>Login</a>";
        };
        })
      })()

      async function Start() {
        await fetch("/api/start")
        .then(response => response.json())
        .then(res => {
          if (res.success) {
            window.location.href = res.data.redirect;
          } else {
            alert(res.errors.detail)
          }
        })
      }
    </script>

  </div>
</body>
</html>